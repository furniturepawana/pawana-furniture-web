<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Pawana Furniture</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/admin.css">
</head>
<body>
  <div class="admin-wrapper">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1>Pawana <span>Furniture</span></h1>
        <p>Admin Panel</p>
      </div>

      <nav class="sidebar-nav">
        <button class="nav-item active" data-tab="sets">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="7" height="7"></rect>
            <rect x="14" y="3" width="7" height="7"></rect>
            <rect x="14" y="14" width="7" height="7"></rect>
            <rect x="3" y="14" width="7" height="7"></rect>
          </svg>
          <span>Sets</span>
        </button>
        <button class="nav-item" data-tab="items">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          <span>Items</span>
        </button>
        <button class="nav-item" data-tab="rooms">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
          </svg>
          <span>Rooms</span>
        </button>
      </nav>

      <form class="logout-form" method="POST" action="/<%= adminRoute %>/logout">
        <button type="submit" class="logout-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
            <polyline points="16 17 21 12 16 7"></polyline>
            <line x1="21" y1="12" x2="9" y2="12"></line>
          </svg>
          <span>Logout</span>
        </button>
      </form>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Sets Tab -->
      <div class="tab-content active" id="sets-tab">
        <div class="content-header">
          <h2>Furniture Sets</h2>
        </div>

        <!-- Room Tabs -->
        <div class="room-tabs">
          <% rooms.forEach((room, index) => { %>
            <button class="room-tab <%= index === 0 ? 'active' : '' %>" data-room="<%= room.name %>">
              <%= room.name %>
            </button>
          <% }) %>
        </div>

        <!-- Style Subtabs with Add Button -->
        <div class="style-row">
          <div class="style-tabs">
            <button class="style-tab active" data-style="Royal">Royal</button>
            <button class="style-tab" data-style="Traditional">Traditional</button>
            <button class="style-tab" data-style="Modern">Modern</button>
          </div>
          <button class="add-btn" id="add-set-btn">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Add Set
          </button>
        </div>

        <!-- Grid -->
        <div class="cards-grid" id="sets-grid">
          <!-- Cards loaded via JS -->
          <div class="loading-text">Loading sets...</div>
        </div>
      </div>

      <!-- Items Tab -->
      <div class="tab-content" id="items-tab">
        <div class="content-header">
          <h2>Furniture Items</h2>
        </div>

        <!-- Room Tabs -->
        <div class="room-tabs" id="items-room-tabs">
          <% rooms.forEach((room, index) => { %>
            <button class="room-tab <%= index === 0 ? 'active' : '' %>" data-room="<%= room.name %>">
              <%= room.name %>
            </button>
          <% }) %>
        </div>

        <!-- Style Subtabs with Type Filter and Add Button -->
        <div class="style-row">
          <div class="style-tabs" id="items-style-tabs">
            <button class="style-tab active" data-style="Royal">Royal</button>
            <button class="style-tab" data-style="Traditional">Traditional</button>
            <button class="style-tab" data-style="Modern">Modern</button>
          </div>
          <div class="style-row-right">
            <div class="type-filter">
              <label for="type-filter-select">Type:</label>
              <select id="type-filter-select">
                <option value="">All Types</option>
              </select>
            </div>
            <button class="add-btn" id="add-item-btn">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
              Add Item
            </button>
          </div>
        </div>

        <!-- Grid -->
        <div class="cards-grid" id="items-grid">
          <div class="loading-text">Loading items...</div>
        </div>
      </div>

      <!-- Rooms Tab -->
      <div class="tab-content" id="rooms-tab">
        <div class="content-header">
          <h2>Rooms</h2>
        </div>

        <!-- Room Tabs -->
        <div class="room-tabs" id="rooms-room-tabs">
          <% rooms.forEach((room, index) => { %>
            <button class="room-tab <%= index === 0 ? 'active' : '' %>" data-room="<%= room.name %>">
              <%= room.name %>
            </button>
          <% }) %>
        </div>

        <!-- Room Details -->
        <div class="room-details" id="room-details">
          <div class="loading-text">Loading room details...</div>
        </div>
      </div>
    </main>
  </div>

  <!-- Add/Edit Set Modal -->
  <div class="modal" id="set-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="set-modal-title">Add New Set</h3>
        <button class="modal-close">&times;</button>
      </div>
      <form id="set-form">
        <input type="hidden" id="set-id" name="id">
        <input type="hidden" id="set-room" name="room">
        <input type="hidden" id="set-style" name="style">

        <div class="form-group">
          <label for="set-name">Name *</label>
          <input type="text" id="set-name" name="name" required maxlength="100">
        </div>

        <div class="form-group">
          <label for="set-description">Description</label>
          <textarea id="set-description" name="description" rows="3"></textarea>
        </div>

        <div class="form-group">
          <label for="set-image">Image (.webp, 4:3 ratio, max 1MB)</label>
          <input type="file" id="set-image" name="image" accept=".webp">
          <div class="image-preview" id="set-image-preview"></div>
        </div>

        <div class="form-info">
          <p><strong>Room:</strong> <span id="set-room-display"></span></p>
          <p><strong>Style:</strong> <span id="set-style-display"></span></p>
        </div>

        <div class="form-group">
          <label for="set-code">Code (leave blank to auto-generate)</label>
          <div class="code-input-group">
            <span class="code-prefix" id="set-code-prefix">LR-</span>
            <input type="text" id="set-code" name="code" placeholder="01" maxlength="2" pattern="[0-9]{2}">
          </div>
          <small class="form-hint">Format: 2 digits (e.g., 01, 15, 99)</small>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel">Cancel</button>
          <button type="submit" class="btn-save">Save Set</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Add/Edit Item Modal -->
  <div class="modal" id="item-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="item-modal-title">Add New Item</h3>
        <button class="modal-close">&times;</button>
      </div>
      <form id="item-form">
        <input type="hidden" id="item-id" name="id">
        <input type="hidden" id="item-room" name="room">
        <input type="hidden" id="item-style" name="style">

        <div class="form-group">
          <label for="item-name">Name *</label>
          <input type="text" id="item-name" name="name" required maxlength="100">
        </div>

        <div class="form-group">
          <label for="item-type-select">Furniture Type *</label>
          <select id="item-type-select" name="type-select">
            <option value="">Select type or add new...</option>
          </select>
        </div>

        <div class="form-group" id="new-type-group" style="display: none;">
          <label for="item-type-new">New Type Name *</label>
          <input type="text" id="item-type-new" name="type-new" placeholder="e.g., Armchair, Ottoman">
        </div>

        <input type="hidden" id="item-type" name="type">

        <div class="form-group">
          <label for="item-price">Price (â‚¹)</label>
          <input type="number" id="item-price" name="price" min="0">
        </div>

        <div class="form-group">
          <label for="item-description">Description</label>
          <textarea id="item-description" name="description" rows="3"></textarea>
        </div>

        <div class="form-group">
          <label for="item-image">Image (.webp, 1:1 ratio, max 1MB)</label>
          <input type="file" id="item-image" name="image" accept=".webp">
          <div class="image-preview" id="item-image-preview"></div>
        </div>

        <div class="form-info">
          <p><strong>Room:</strong> <span id="item-room-display"></span></p>
          <p><strong>Style:</strong> <span id="item-style-display"></span></p>
        </div>

        <div class="form-group">
          <label for="item-code">Code (leave blank to auto-generate)</label>
          <div class="code-input-group">
            <span class="code-prefix" id="item-code-prefix">LR-</span>
            <input type="text" id="item-code" name="code" placeholder="001" maxlength="3" pattern="[0-9]{3}">
          </div>
          <small class="form-hint">Format: 3 digits (e.g., 001, 015, 099)</small>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel">Cancel</button>
          <button type="submit" class="btn-save">Save Item</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Image Upload Modal -->
  <div class="modal" id="image-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Update Image</h3>
        <button class="modal-close">&times;</button>
      </div>
      <form id="image-form" enctype="multipart/form-data">
        <input type="hidden" id="image-collection" name="collection">
        <input type="hidden" id="image-doc-id" name="documentId">
        <input type="hidden" id="image-index" name="imageIndex" value="-1">

        <div class="form-group">
          <label for="image-file">Select Image (JPG, PNG, WebP - Max 5MB)</label>
          <input type="file" id="image-file" name="image" accept=".jpg,.jpeg,.png,.webp" required>
        </div>

        <div class="image-preview" id="image-preview"></div>

        <div class="form-actions">
          <button type="button" class="btn-cancel">Cancel</button>
          <button type="submit" class="btn-save">Upload Image</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal" id="delete-modal">
    <div class="modal-content modal-small">
      <div class="modal-header">
        <h3>Confirm Delete</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this item?</p>
        <p class="delete-warning">This action cannot be undone.</p>
      </div>
      <div class="form-actions">
        <button type="button" class="btn-cancel">Cancel</button>
        <button type="button" class="btn-delete" id="confirm-delete-btn">Delete</button>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div class="toast" id="toast"></div>

  <script>
    const ADMIN_ROUTE = '<%= adminRoute %>';
  </script>
  <script src="/js/admin.js"></script>
</body>
</html>
