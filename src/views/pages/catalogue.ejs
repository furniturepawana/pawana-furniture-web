<!-- Catalogue Page -->
<section class="catalogue-hero">
  <div class="catalogue-hero-content">
    <h1>Our Collection</h1>
    <p>Explore our exquisite range of handcrafted furniture</p>
  </div>
</section>

<section class="catalogue-section">
  <div class="catalogue-container">

    <!-- Products Area with Top Filters -->
    <div class="catalogue-products">

      <!-- Header with Dropdown Filters -->
      <div class="catalogue-header">
        <div class="catalogue-header-left">
          <h2>
            <% if (filters.view === 'items') { %>
              Individual Items
            <% } else if (filters.view === 'sets') { %>
              Furniture Sets
            <% } else { %>
              All Products
            <% } %>
          </h2>
          <p class="results-count">
            Showing <%= (filters.view === 'all' || filters.view === 'items' ? items.length : 0) + (filters.view === 'all' || filters.view === 'sets' ? sets.length : 0) %> results
          </p>
        </div>

        <!-- Dropdown Filters -->
        <div class="catalogue-filters-dropdowns">
          <!-- View Dropdown -->
          <div class="filter-dropdown">
            <select id="view-filter" onchange="updateFilter('view', this.value)">
              <option value="all" <%= filters.view === 'all' ? 'selected' : '' %>>All</option>
              <option value="items" <%= filters.view === 'items' ? 'selected' : '' %>>Items</option>
              <option value="sets" <%= filters.view === 'sets' ? 'selected' : '' %>>Sets</option>
            </select>
            <label for="view-filter">View</label>
          </div>

          <!-- Room Dropdown -->
          <div class="filter-dropdown">
            <select id="room-filter" onchange="updateFilter('room', this.value)">
              <option value="" <%= !filters.room ? 'selected' : '' %>>All Rooms</option>
              <% allRooms.forEach(room => { %>
                <option value="<%= room %>" <%= filters.room === room ? 'selected' : '' %>><%= room %></option>
              <% }); %>
            </select>
            <label for="room-filter">Room</label>
          </div>

          <!-- Type Dropdown -->
          <div class="filter-dropdown">
            <select id="type-filter" onchange="updateFilter('type', this.value)">
              <option value="" <%= !filters.type ? 'selected' : '' %>>All Types</option>
              <% allTypes.forEach(type => { %>
                <option value="<%= type %>" <%= filters.type && filters.type.toLowerCase() === type.toLowerCase() ? 'selected' : '' %>><%= type %></option>
              <% }); %>
            </select>
            <label for="type-filter">Type</label>
          </div>

          <!-- Style Dropdown -->
          <div class="filter-dropdown">
            <select id="style-filter" onchange="updateFilter('style', this.value)">
              <option value="" <%= !filters.style ? 'selected' : '' %>>All Styles</option>
              <% allStyles.forEach(style => { %>
                <option value="<%= style %>" <%= filters.style === style ? 'selected' : '' %>><%= style %></option>
              <% }); %>
            </select>
            <label for="style-filter">Style</label>
          </div>

          <!-- Clear Filters Button -->
          <button class="clear-filters-btn-top" onclick="clearFilters()" title="Clear all filters">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Sets -->
      <div class="catalogue-sets-grid">
        <% sets.forEach(set => { %>
          <a href="/set/<%= set.slug %>" class="set-card"
             data-style="<%= set.style %>"
             data-room="<%= set.room %>"
             data-type="set">
            <div class="set-card-badge">Set</div>
            <img
              src="<%= set.images && set.images.length > 0 ? set.images[0].url : '/images/placeholder.jpg' %>"
              alt="<%= set.name %>"
            />
            <h3><%= set.name %></h3>
            <div class="set-card-meta">
              <span class="set-style-badge <%= set.style.toLowerCase() %>"><%= set.style %></span>
              <p><%= set.room %></p>
            </div>
            <p class="model-number"><strong>Model:</strong> <%= set.code %></p>
          </a>
        <% }); %>
      </div>

      <!-- Items -->
      <div class="catalogue-items-grid">
        <% items.forEach(item => { %>
          <a href="/item/<%= item.slug %>" class="product-card"
             data-style="<%= item.style %>"
             data-room="<%= item.room %>"
             data-type="<%= item.type %>">
            <img
              src="<%= item.images && item.images.length > 0 ? item.images[0].url : '/images/placeholder.jpg' %>"
              alt="<%= item.name %>"
            />
            <h3><%= item.name %></h3>
            <div class="product-card-meta">
              <span class="item-style-badge <%= item.style.toLowerCase() %>"><%= item.style %></span>
              <p><%= item.type %> Â· <%= item.room %></p>
            </div>
            <p class="model-number"><strong>Model:</strong> <%= item.code %></p>
          </a>
        <% }); %>
      </div>

      <!-- No Results -->
      <div class="no-results" style="display: none;">
        <h3>No products found</h3>
        <p>Try adjusting your filters to see more results</p>
        <button class="btn-primary" onclick="clearFilters()">Clear Filters</button>
      </div>
    </div>

  </div>
</section>

<script>
function updateFilter(filterName, value) {
  // If type filter is changed to a specific type (not "All Types"), automatically select "Items"
  if (filterName === 'type' && value !== '') {
    document.getElementById('view-filter').value = 'items';
  }

  applyFilters();
}

function applyFilters() {
  const viewFilter = document.getElementById('view-filter').value;
  const roomFilter = document.getElementById('room-filter').value;
  const typeFilter = document.getElementById('type-filter').value;
  const styleFilter = document.getElementById('style-filter').value;

  const allSets = document.querySelectorAll('.set-card');
  const allItems = document.querySelectorAll('.product-card');
  const setsGrid = document.querySelector('.catalogue-sets-grid');
  const itemsGrid = document.querySelector('.catalogue-items-grid');
  const noResults = document.querySelector('.no-results');

  let visibleCount = 0;

  // Filter and show/hide sets
  if (typeFilter === '') {
    // Only show sets if no type filter is selected
    allSets.forEach(set => {
      let show = true;
      if (styleFilter && set.dataset.style !== styleFilter) show = false;
      if (roomFilter && set.dataset.room !== roomFilter) show = false;
      if (viewFilter === 'items') show = false;

      set.style.display = show ? 'block' : 'none';
      if (show) visibleCount++;
    });
    setsGrid.style.display = (viewFilter === 'items') ? 'none' : 'grid';
  } else {
    // Hide all sets when type filter is active
    allSets.forEach(set => set.style.display = 'none');
    setsGrid.style.display = 'none';
  }

  // Filter and show/hide items
  allItems.forEach(item => {
    let show = true;
    if (styleFilter && item.dataset.style !== styleFilter) show = false;
    if (roomFilter && item.dataset.room !== roomFilter) show = false;
    if (typeFilter && item.dataset.type.toLowerCase() !== typeFilter.toLowerCase()) show = false;
    if (viewFilter === 'sets') show = false;

    item.style.display = show ? 'block' : 'none';
    if (show) visibleCount++;
  });
  itemsGrid.style.display = (viewFilter === 'sets') ? 'none' : 'grid';

  // Update header title
  const headerTitle = document.querySelector('.catalogue-header h2');
  if (viewFilter === 'items') {
    headerTitle.textContent = 'Individual Items';
  } else if (viewFilter === 'sets') {
    headerTitle.textContent = 'Furniture Sets';
  } else {
    headerTitle.textContent = 'All Products';
  }

  // Update results count
  document.querySelector('.results-count').textContent = `Showing ${visibleCount} results`;

  // Show/hide no results message
  noResults.style.display = visibleCount === 0 ? 'block' : 'none';
}

function clearFilters() {
  document.getElementById('room-filter').value = '';
  document.getElementById('type-filter').value = '';
  document.getElementById('style-filter').value = '';
  document.getElementById('view-filter').value = 'all';
  applyFilters();
}

// Apply filters on page load to respect query parameters
document.addEventListener('DOMContentLoaded', function() {
  applyFilters();
});
</script>