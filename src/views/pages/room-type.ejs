<!-- Room-Type Page (e.g., Living Room Chairs) -->

<!-- Room Hero Section -->
<section class="room-hero">
  <div class="room-hero-content">
    <h1><%= room.name %></h1>
    <% if (room.description) { %>
    <p><%= room.description %></p>
    <% } else { %>
    <p>Explore our curated collections for your <%= room.name.toLowerCase() %></p>
    <% } %>
  </div>
</section>

<!-- Breadcrumb -->
<section class="room-page-section">
  <div class="room-page-container">
    <div class="item-breadcrumb">
      <a href="javascript:history.back()" class="breadcrumb-back" aria-label="Go back">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 12h18M3 12l6-6M3 12l6 6"/>
        </svg>
      </a>
      <a href="/">Home</a> /
      <a href="/room/<%= room.slug %>"><%= room.name %></a> /
      <span><%= type %></span>
    </div>
  </div>
</section>




<!-- Items Grid -->
<% if (items && items.length > 0) { %>
<%
  // Extract unique styles for the filter dropdown
  // Custom order: Royal -> Traditional -> Modern
  const styleOrder = ['Royal', 'Traditional', 'Modern'];
  const styles = [...new Set(items.map(item => item.style))].sort((a, b) => {
    const aIndex = styleOrder.indexOf(a);
    const bIndex = styleOrder.indexOf(b);
    if (aIndex === -1 && bIndex === -1) return a.localeCompare(b);
    if (aIndex === -1) return 1;
    if (bIndex === -1) return -1;
    return aIndex - bIndex;
  });
%>
<section class="room-type-items-section">
  <div class="room-type-container">
    <div class="room-type-header">
      <div class="room-type-header-left">
        <h2><%= type %> Collection</h2>

      </div>

      <div class="room-type-filters">
        <div class="style-filter-tabs" id="style-tabs">
          <button class="style-tab active" data-style="" onclick="filterItems('')">All</button>
          <% styles.forEach(style => { %>
            <button class="style-tab" data-style="<%= style %>" onclick="filterItems('<%= style %>')"><%= style %></button>
          <% }); %>
        </div>
      </div>
    </div>

    <div class="catalogue-items-grid">
      <% items.forEach(item => { %>
        <div class="product-card-wrapper" data-style="<%= item.style %>">
          <a href="/item/<%= item.slug %>" class="product-card">
            <img
              src="<%= item.images && item.images.length > 0 ? item.images[0].url : '/images/placeholder.jpg' %>"
              alt="<%= item.name %>"
            />
            <div class="card-name-row">
              <h3><%= item.name %></h3>
              <button class="wishlist-btn"
                      data-id="<%= item._id %>"
                      data-type="item"
                      data-name="<%= item.name %>"
                      data-slug="<%= item.slug %>"
                      data-image="<%= item.images && item.images.length > 0 ? item.images[0].url : '/images/placeholder.jpg' %>"
                      onclick="handleWishlistClick(event, this)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                </svg>
              </button>
            </div>
            <div class="product-card-meta">
              <span class="item-style-badge <%= item.style.toLowerCase() %>"><%= item.style %></span>
              <p><%= item.room %> · <%= item.type %><% if (item.code) { %> · <%= item.code %><% } %></p>
            </div>
          </a>
        </div>
      <% }); %>
    </div>

    <!-- Pagination -->
    <div class="pagination-container" id="roomtype-pagination"></div>

    <!-- No Results Message (Hidden by default) -->
    <div class="no-results-filter" style="display: none; text-align: center; padding: 3rem 0;">
      <h3>No items found</h3>
      <p>Try selecting a different style.</p>
      <button class="btn-primary" onclick="resetFilter()" style="margin-top: 1rem;">Show All Styles</button>
    </div>
  </div>
</section>

<script>
  let roomTypePagination = null;

  function filterItems(selectedStyle) {
    const items = document.querySelectorAll('.product-card-wrapper');
    const resultsCount = document.querySelector('.results-count');
    const noResultsMsg = document.querySelector('.no-results-filter');
    const itemsGrid = document.querySelector('.catalogue-items-grid');

    // Update active tab
    const tabs = document.querySelectorAll('.style-tab');
    tabs.forEach(tab => {
      if (tab.getAttribute('data-style') === selectedStyle) {
        tab.classList.add('active');
      } else {
        tab.classList.remove('active');
      }
    });

    let visibleCount = 0;

    items.forEach(item => {
      const itemStyle = item.getAttribute('data-style');
      if (selectedStyle === '' || itemStyle === selectedStyle) {
        item.removeAttribute('data-filtered-out');
        visibleCount++;
      } else {
        item.setAttribute('data-filtered-out', 'true');
      }
    });

    // Update count text
    if (resultsCount) {
      resultsCount.textContent = `${visibleCount} ${visibleCount === 1 ? 'item' : 'items'} found`;
    }

    // Show/hide no results message
    if (visibleCount === 0) {
      itemsGrid.style.display = 'none';
      noResultsMsg.style.display = 'block';
    } else {
      itemsGrid.style.display = 'grid';
      noResultsMsg.style.display = 'none';
    }

    // Refresh pagination
    if (roomTypePagination) {
      roomTypePagination.refresh();
    }
  }

  function resetFilter() {
    filterItems('');
  }

  // Initialize pagination on page load
  document.addEventListener('DOMContentLoaded', function() {
    roomTypePagination = initPagination({
      gridSelector: '.catalogue-items-grid',
      itemSelector: '.product-card-wrapper',
      paginationSelector: '#roomtype-pagination',
      desktopPerPage: 15,
      mobilePerPage: 6
    });
  });
</script>
<% } else { %>
<!-- No Items Found -->
<section class="room-type-items-section">
  <div class="room-type-container">
    <div class="no-results">
      <h3>No <%= type %> Found</h3>
      <p>We don't have any <%= type.toLowerCase() %> in our <%= room.name %> collection yet.</p>
      <a href="/room/<%= room.slug %>" class="btn-primary">Browse All <%= room.name %> Furniture</a>
    </div>
  </div>
</section>
<% } %>

<!-- Explore Other Types in This Room -->
<% if (room.types && room.types.length > 0) { %>
<section class="explore-types-section">
  <div class="room-type-container">
    <h2>Explore More <%= room.name %> Furniture</h2>
    <div class="types-grid">
      <% room.types.filter(t => t.toLowerCase() !== typeSlug.toLowerCase()).forEach(roomType => { %>
        <a href="/room/<%= room.slug %>/<%= roomType.toLowerCase() %>" class="type-card">
          <h3><%= roomType %></h3>
          <span class="arrow">→</span>
        </a>
      <% }); %>
      <a href="/room/<%= room.slug %>" class="type-card featured">
        <h3>View All <%= room.name %></h3>
        <span class="arrow">→</span>
      </a>
    </div>
  </div>
</section>
<% } %>