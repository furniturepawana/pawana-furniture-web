<!-- Item Detail Page -->
<!-- Item Detail Page -->

<section class="item-detail-section">
  <div class="item-detail-container">
    <!-- Breadcrumb -->
    <section class="breadcrumb-section">
      <div class="breadcrumb-container">
        <div class="page-breadcrumb">
          <a href="javascript:history.back()" class="breadcrumb-back" aria-label="Go back">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 12h18M3 12l6-6M3 12l6 6"/>
            </svg>
          </a>
          <a href="/">Home</a> /
          <a href="/room/<%= item.room.toLowerCase().replace(/ /g, '-') %>"><%= item.room %></a> /
          <span><%= item.name %></span>
        </div>
      </div>
    </section>

    <!-- Main Content - Side by Side -->
    <div class="item-content">

      <!-- Left: Image -->
      <div class="item-image-section">
        <div class="item-image-main">
          <img
            id="mainItemImage"
            src="<%= item.images && item.images.length > 0 ? item.images[0].url : '/images/placeholder.jpg' %>"
            alt="<%= item.name %>"
          />
        </div>

        <!-- Thumbnails Below Image -->
        <% if (item.images && item.images.length > 1) { %>
        <div class="item-thumbnails">
          <% item.images.forEach((image, index) => { %>
            <img
              src="<%= image.url %>"
              alt="<%= item.name %> - View <%= index + 1 %>"
              class="thumbnail <%= index === 0 ? 'active' : '' %>"
              onclick="changeMainImage('<%= image.url %>', this)"
            />
          <% }); %>
        </div>
        <% } %>
      </div>

      <!-- Right: Info -->
      <div class="item-info">
        <div class="item-header">
          <div class="item-title-row">
            <h1 class="item-title" id="itemTitle"><%= item.name %></h1>
            <button
              class="wishlist-btn detail-wishlist"
              data-id="<%= item._id %>"
              data-type="item"
              data-name="<%= item.name %>"
              data-slug="<%= item.slug %>"
              data-image="<%= item.images && item.images.length > 0 ? item.images[0].url : '/images/placeholder.jpg' %>"
              onclick="handleWishlistClick(event, this)"
              aria-label="Add to wishlist">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
              </svg>
            </button>
          </div>
          <div class="item-meta">
            <span class="item-room"><%= item.room %></span>
            <span class="item-style-badge <%= item.style.toLowerCase() %>" id="itemStyleBadge"><%= item.style %></span>
          </div>
          <p class="item-type-code"><span class="item-type-text" id="itemType"><%= item.type %></span> · <%= item.code %></p>
        </div>

        <% if (item.description) { %>
        <p class="item-description" id="itemDescription"><%= item.description %></p>
        <% } %>

        <!-- Enquiry Button -->
        <button class="btn-primary enquiry-btn" onclick="openEnquiryForm()">
          Get an Enquiry
        </button>
      </div>
    </div>
  </div>
</section>

<!-- Similar Items Carousel -->
<% if (similarItems && similarItems.length > 0) { %>
<section class="home-carousel">
  <div class="section-container">
    <div class="carousel-header">
      <h2 class="section-title">Similar <%= item.style %> <%= item.type %> for <%= item.room %></h2>
    </div>
    <div class="carousel-wrapper">
      <div class="carousel-nav">
        <button class="carousel-arrow carousel-prev" data-carousel="similar-items" aria-label="Previous item">‹</button>
        <button class="carousel-arrow carousel-next" data-carousel="similar-items" aria-label="Next item">›</button>
      </div>
      <div class="carousel-container">
        <div class="carousel-track" id="similar-items-carousel-track">
          <% similarItems.forEach(similarItem => { %>
          <div class="carousel-item active-category" data-category="similar-items">
            <a href="/item/<%= similarItem.slug %>" class="product-card">
              <img src="<%= similarItem.images && similarItem.images.length > 0 ? similarItem.images[0].url : '/images/placeholder.jpg' %>" alt="<%= similarItem.name %>">
              <div class="card-name-row">
                <h3><%= similarItem.name %></h3>
              </div>
              <div class="product-card-meta">
                <span class="item-style-badge <%= similarItem.style.toLowerCase() %>"><%= similarItem.style %></span>
                <p><%= similarItem.room %> · <%= similarItem.type %> · <%= similarItem.code %></p>
              </div>
            </a>
          </div>
          <% }); %>
        </div>
      </div>
    </div>
  </div>
</section>
<% } %>

<!-- You May Also Like Section -->
<% if (relatedItems && relatedItems.length > 0) { %>
<section class="related-items-section">
  <div class="related-items-container">
    <h2>You May Also Like</h2>
    <div class="product-grid">
      <% relatedItems.forEach(relatedItem => { %>
        <a href="/item/<%= relatedItem.slug %>" class="product-card">
          <img
            class="related-item-image square"
            src="<%= relatedItem.images && relatedItem.images.length > 0 ? relatedItem.images[0].url : '/images/placeholder.jpg' %>"
            alt="<%= relatedItem.name %>"
          />
          <div class="card-name-row">
            <h3><%= relatedItem.name %></h3>
          </div>
          <div class="product-card-meta">
            <span class="item-style-badge <%= relatedItem.style.toLowerCase() %>"><%= relatedItem.style %></span>
            <p><%= relatedItem.room %> · <%= relatedItem.type %> · <%= relatedItem.code %></p>
          </div>
        </a>
      <% }); %>
    </div>
  </div>
</section>
<% } %>


<script>
// Change main image from thumbnails
function changeMainImage(url, thumbnail) {
  document.getElementById('mainItemImage').src = url;
  document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
  thumbnail.classList.add('active');
}

// Enquiry form
function openEnquiryForm() {
  const itemName = document.getElementById('itemTitle').textContent;
  alert(`Enquiry form for ${itemName} - This will be implemented with a modal or redirect to contact page`);
  // TODO: Implement enquiry modal or redirect
}

// Dynamic style toggle functionality
document.querySelectorAll('.style-toggle-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    // Parse item data
    const itemData = JSON.parse(this.dataset.item);

    // Update active button
    document.querySelectorAll('.style-toggle-btn').forEach(b => b.classList.remove('active'));
    this.classList.add('active');

    // Update main image
    if (itemData.images && itemData.images.length > 0) {
      document.getElementById('mainItemImage').src = itemData.images[0].url;
    }

    // Update thumbnails
    const thumbnailsContainer = document.querySelector('.item-thumbnails');
    if (thumbnailsContainer && itemData.images && itemData.images.length > 1) {
      thumbnailsContainer.innerHTML = '';
      itemData.images.forEach((image, index) => {
        const thumb = document.createElement('img');
        thumb.src = image.url;
        thumb.alt = `${itemData.name} - View ${index + 1}`;
        thumb.className = `thumbnail ${index === 0 ? 'active' : ''}`;
        thumb.onclick = function() { changeMainImage(image.url, this); };
        thumbnailsContainer.appendChild(thumb);
      });
    } else if (thumbnailsContainer) {
      thumbnailsContainer.innerHTML = '';
    }

    // Update title
    document.getElementById('itemTitle').textContent = itemData.name;

    // Update type
    document.getElementById('itemType').textContent = itemData.type;

    // Update description
    const descElement = document.getElementById('itemDescription');
    if (descElement) {
      descElement.textContent = itemData.description;
    }

    // Update style badge
    const badge = document.getElementById('itemStyleBadge');
    badge.textContent = itemData.style;
    badge.className = `item-style-badge ${itemData.style.toLowerCase()}`;

    // Update URL without reload
    window.history.pushState({}, '', `/item/${itemData.slug}`);
  });
});
</script>