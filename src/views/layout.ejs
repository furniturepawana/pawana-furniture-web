<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= title %> | Luxury Furniture Studio</title>

    <!-- Google Fonts: Playfair Display + Lato -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/css/main.css" />
  </head>

  <body class="<%= typeof pageClass !== 'undefined' ? pageClass : '' %>">
    <!-- Header -->
    <header class="site-header">
      <a class="logo" href="/">
        <img src="https://res.cloudinary.com/dwa2d4onb/image/upload/v1763917320/pf_icon_rxglcl.png" alt="Pawana Furniture Logo" class="logo-image">
        <span class="logo-text">Pawana<span class="logo-text-light">Furniture</span></span>
      </a>
      <nav class="nav-links">
      <a href="/about">About Pawana</a>
      <div class="dropdown">
        <a href="/catalogue">Collection</a>
        <div class="dropdown-content collections-dropdown">
          <div class="dropdown-list">
            <% if (typeof navRooms !== 'undefined' && navRooms.length > 0) { %>
              <% navRooms.forEach(room => { %>
                <div class="dropdown-item">
                  <a href="/room/<%= room.slug %>">
                    <%= room.name %>
                    <% if (room.types && room.types.length > 0) { %>
                      <span class="arrow">›</span>
                    <% } %>
                  </a>
                  <% if (room.types && room.types.length > 0) { %>
                    <div class="sub-dropdown">
                      <% room.types.forEach(type => { %>
                        <a href="/room/<%= room.slug %>/<%= type.toLowerCase() %>"><%= type %></a>
                      <% }); %>
                      <a href="/room/<%= room.slug %>" style="font-weight: 600; margin-top: 5px; border-top: 1px solid rgba(0,0,0,0.05);">View All <%= room.name %></a>
                    </div>
                  <% } %>
                </div>
              <% }); %>
            <% } else { %>
              <!-- Fallback if navRooms is missing -->
              <div class="dropdown-item">
                <a href="/room/living-room">Living Room <span class="arrow">›</span></a>
                <div class="sub-dropdown">
                  <a href="/room/living-room/sofa">Sofas</a>
                  <a href="/room/living-room/chair">Chairs</a>
                  <a href="/room/living-room/table">Tables</a>
                </div>
              </div>
              <div class="dropdown-item">
                <a href="/room/bedroom">Bedroom <span class="arrow">›</span></a>
                <div class="sub-dropdown">
                  <a href="/room/bedroom/bed">Beds</a>
                  <a href="/room/bedroom/cabinet">Wardrobes</a>
                </div>
              </div>
              <div class="dropdown-item">
                <a href="/room/dining-room">Dining Room <span class="arrow">›</span></a>
                <div class="sub-dropdown">
                  <a href="/room/dining-room/table">Dining Tables</a>
                  <a href="/room/dining-room/chair">Dining Chairs</a>
                </div>
              </div>
            <% } %>
          </div>
        </div>
      </div>
           <a href="/services">Services</a>
           <a href="/contact">Contact</a>
       </nav>
       <div class="header-actions">
         <!-- Inline Search -->
         <div class="search-wrapper">
           <button class="header-icon search-icon" aria-label="Search">
             <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
               <circle cx="11" cy="11" r="8"></circle>
               <path d="m21 21-4.35-4.35"></path>
             </svg>
           </button>
           <div class="search-box">
             <input type="text" placeholder="Search furniture..." class="search-input">
             <button class="search-close" aria-label="Close search">
               <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                 <line x1="18" y1="6" x2="6" y2="18"></line>
                 <line x1="6" y1="6" x2="18" y2="18"></line>
               </svg>
             </button>
           </div>
           <!-- Search Results Dropdown -->
           <div class="search-dropdown">
             <div class="search-results"></div>
           </div>
         </div>
         <!-- Wishlist Icon -->
         <div class="wishlist-wrapper">
           <a href="/wishlist" class="header-icon wishlist-icon" aria-label="Wishlist">
             <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
               <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
             </svg>
             <span class="wishlist-count" style="display: none;">0</span>
           </a>
           <!-- Wishlist Preview Dropdown -->
           <div class="wishlist-preview">
             <div class="wishlist-preview-items">
               <p class="wishlist-empty">Your wishlist is empty</p>
             </div>
             <a href="/wishlist" class="wishlist-preview-link">View All</a>
           </div>
         </div>
          <!-- Mobile Menu Button (hamburger) -->
          <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Open menu">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <line x1="3" y1="12" x2="21" y2="12"></line>
              <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
          </button>
       </div>
    </header>

    <!-- Mobile Navigation Drawer -->
    <div class="mobile-nav-overlay" id="mobileNavOverlay"></div>
    <nav class="mobile-nav-drawer" id="mobileNavDrawer">
      <div class="mobile-nav-header">
        <span class="mobile-nav-title">Menu</span>
        <button class="mobile-nav-close" id="mobileNavClose" aria-label="Close menu">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <ul class="mobile-nav-links">
        <li><a href="/about">About Pawana</a></li>
        <li class="mobile-nav-dropdown">
          <a href="/catalogue" class="mobile-nav-link-text">Collection</a>
          <button class="mobile-nav-arrow-btn" aria-label="Expand Collection">
            <span class="mobile-nav-arrow">›</span>
          </button>
        </li>
        <li><a href="/services">Services</a></li>
        <li><a href="/contact">Contact</a></li>
      </ul>
      <div class="mobile-nav-footer">
        <a href="/wishlist" class="mobile-nav-wishlist">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
          </svg>
          View Wishlist
        </a>
      </div>
    </nav>

    <!-- Mobile Rooms Submenu Panel (positioned at Collection level) -->
    <div class="mobile-rooms-panel" id="mobileRoomsPanel">
      <div class="mobile-panel-header">
        <button class="mobile-panel-back" id="mobileRoomsPanelBack" aria-label="Back">
          <span>‹</span>
        </button>
        <span class="mobile-panel-title">Collection</span>
      </div>
      <div class="mobile-panel-content">
        <% if (typeof navRooms !== 'undefined' && navRooms.length > 0) { %>
          <% navRooms.forEach(room => { %>
            <div class="mobile-nav-room" data-room="<%= room.slug %>">
              <a href="/room/<%= room.slug %>" class="mobile-room-link"><%= room.name %></a>
              <% if (room.types && room.types.length > 0) { %>
                <button class="mobile-nav-arrow-btn" aria-label="Expand <%= room.name %>">
                  <span class="mobile-nav-arrow">›</span>
                </button>
                <div class="mobile-nav-types">
                  <% room.types.forEach(type => { %>
                    <a href="/room/<%= room.slug %>/<%= type.toLowerCase() %>"><%= type %></a>
                  <% }); %>
                  <a href="/room/<%= room.slug %>" class="view-all-link">View All</a>
                </div>
              <% } %>
            </div>
          <% }); %>
        <% } else { %>
          <div class="mobile-nav-room">
            <a href="/room/living-room" class="mobile-room-link">Living Room</a>
          </div>
          <div class="mobile-nav-room">
            <a href="/room/bedroom" class="mobile-room-link">Bedroom</a>
          </div>
          <div class="mobile-nav-room">
            <a href="/room/dining-room" class="mobile-room-link">Dining Room</a>
          </div>
        <% } %>
      </div>
    </div>

    <!-- Main Content -->
    <main>
      <%- body %>
    </main>

    <!-- Footer -->
    <footer class="site-footer">
      <div class="section-container">
        <div class="footer-grid">
          <div class="footer-brand">
            <a href="/" class="logo" style="color: #fff;">
              <span class="logo-text">Pawana<span class="logo-text-light">Furniture</span></span>
            </a>
            <p>Redefining luxury interiors with timeless design and sustainable practices. Workshop in Rajpura.</p>
          </div>

          <div class="footer-col">
            <h4>Shop</h4>
            <ul>
              <li><a href="/catalogue">All Collections</a></li>
              <li><a href="/catalogue?sort=newest">New Arrivals</a></li>
              <li><a href="/room/living-room">Living Room</a></li>
              <li><a href="/room/bedroom">Bedroom</a></li>
            </ul>
          </div>

          <div class="footer-col">
            <h4>Support</h4>
            <ul>
              <li><a href="/services">Our Services</a></li>
              <li><a href="/about">About Us</a></li>
              <li><a href="/contact">Contact Us</a></li>
              <li><a href="/wishlist">Your Wishlist</a></li>
            </ul>
          </div>

          <div class="footer-col">
            <h4>Stay in the loop</h4>
            <form class="newsletter" onsubmit="event.preventDefault();">
              <input type="email" placeholder="Email Address" required>
              <button class="btn btn-gold" style="width: 100%">Subscribe</button>
            </form>
          </div>
        </div>
        <div class="copyright">
          &copy; <%= new Date().getFullYear() %> Pawana Furniture. All rights reserved.
        </div>
      </div>
    </footer>

    <script src="/js/index.js"></script>
    <script src="/js/dropdown.js"></script>
    <script src="/js/wishlist.js"></script>
    <script src="/js/search.js"></script>

    <!-- Scroll Animations -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // Header Scroll Effect - Hide on scroll down, show on scroll up
        const header = document.querySelector('.site-header');
        let lastScrollY = window.scrollY;
        let scrollUpDistance = 0;
        let isNavHidden = false;
        let ticking = false;

        if (header) {
          window.addEventListener('scroll', () => {
            if (!ticking) {
              window.requestAnimationFrame(() => {
                const currentScrollY = window.scrollY;
                const scrollDelta = lastScrollY - currentScrollY;

                // Get hero section height (if on home page)
                const heroSection = document.querySelector('.hero');
                const heroHeight = heroSection ? heroSection.offsetHeight : 300;

                // Add scrolled class only after passing hero section
                if (currentScrollY > heroHeight - 60) {
                  header.classList.add('scrolled');
                } else {
                  header.classList.remove('scrolled');
                }

                // Track scroll direction
                if (scrollDelta > 0) {
                  // Scrolling up
                  scrollUpDistance += scrollDelta;

                  // Only show navbar after 100px of upward scrolling
                  if (scrollUpDistance >= 100 && isNavHidden) {
                    header.classList.remove('nav-hidden');
                    isNavHidden = false;
                  }
                } else {
                  // Scrolling down - reset upward distance
                  scrollUpDistance = 0;

                  if (currentScrollY > 100 && !isNavHidden) {
                    header.classList.add('nav-hidden');
                    isNavHidden = true;
                  }
                }

                lastScrollY = currentScrollY;
                ticking = false;
              });
              ticking = true;
            }
          });
        }

        // Intersection Observer for fade-in animations
        const observerOptions = {
          root: null,
          rootMargin: '0px',
          threshold: 0.1
        };

        const observer = new IntersectionObserver((entries, observer) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('is-visible');
              observer.unobserve(entry.target); // Only animate once
            }
          });
        }, observerOptions);

        // Observe all fade-in sections
        const fadeElements = document.querySelectorAll('.fade-in-section');
        fadeElements.forEach(el => observer.observe(el));
      });
    </script>
  </body>
</html>
